Simplyfied and minimized. Works on .NET 8.0 and C#11, with some null warnings though.
